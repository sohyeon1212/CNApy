# CNApy CrewAI Task Templates
# Predefined task templates for common metabolic analysis workflows

# Simple analysis tasks
analyze_request:
  description: |
    Analyze the user's request and perform the appropriate metabolic analysis.

    User request: {user_message}

    Instructions:
    1. Understand what analysis the user wants
    2. Extract any parameters (conditions, values, ranges)
    3. Execute the appropriate tool(s)
    4. Return results in a clear format
  expected_output: "Analysis results with interpretation"
  agent: flux_analyst

# Parametric analysis task
parametric_analysis:
  description: |
    Perform parametric analysis varying a parameter across a range.

    User request: {user_message}

    Instructions:
    1. Identify the analysis type (FBA, pFBA, FVA)
    2. Identify the parameter to vary (growth_rate, oxygen_uptake)
    3. Extract the range (start_percent, end_percent)
    4. Extract the step size (step_percent, default 10)
    5. Execute parametric_analysis tool with extracted parameters
    6. Present results in tabular format

    Examples:
    - "Growth rate 0~100% 10%ì”© pFBA" -> pfba, growth_rate, 0, 100, 10
    - "Oxygen 0-20 mmol with FBA" -> fba, oxygen_uptake, 0, 100, 20
  expected_output: "Parametric analysis results with data points"
  agent: flux_analyst

# Multi-step workflow task
multi_step_workflow:
  description: |
    Execute a multi-step workflow based on the user's complex request.

    User request: {user_message}

    Instructions:
    1. Break down the request into individual steps
    2. Execute steps in the correct order
    3. Pass results between steps as needed
    4. Report results of each step
  expected_output: "Results from all steps in the workflow"
  agent: flux_analyst

# Condition setup task
setup_condition:
  description: |
    Configure the culture condition for metabolic analysis.

    User request: {user_message}

    Instructions:
    1. Identify the condition type (aerobic, anaerobic, microaerobic)
    2. Identify any carbon/nitrogen source changes
    3. Apply the conditions using appropriate tools
    4. Confirm the changes made
  expected_output: "Confirmation of applied conditions"
  agent: scenario_manager

# Gene analysis task
analyze_genes:
  description: |
    Perform gene-related analysis based on the user's request.

    User request: {user_message}

    Instructions:
    1. Identify what gene analysis is needed
    2. Extract gene IDs if specified
    3. Execute appropriate gene analysis tool
    4. Interpret and present results
  expected_output: "Gene analysis results with interpretation"
  agent: gene_analyst

# Model query task
query_model:
  description: |
    Answer questions about the metabolic model.

    User request: {user_message}

    Instructions:
    1. Understand what information is being requested
    2. Search for relevant reactions, metabolites, or genes
    3. Present information clearly
  expected_output: "Requested model information"
  agent: data_query

# Common workflow templates
workflows:
  fba_aerobic:
    name: "FBA under Aerobic Condition"
    steps:
      - agent: scenario_manager
        skill: apply_condition
        params:
          condition_name: aerobic
      - agent: flux_analyst
        skill: perform_fba
        params: {}

  fba_anaerobic:
    name: "FBA under Anaerobic Condition"
    steps:
      - agent: scenario_manager
        skill: apply_condition
        params:
          condition_name: anaerobic
      - agent: flux_analyst
        skill: perform_fba
        params: {}

  essential_genes_aerobic:
    name: "Find Essential Genes (Aerobic)"
    steps:
      - agent: scenario_manager
        skill: apply_condition
        params:
          condition_name: aerobic
      - agent: gene_analyst
        skill: find_essential_genes
        params:
          threshold: 0.01

  knockout_then_fba:
    name: "Gene Knockout followed by FBA"
    steps:
      - agent: gene_analyst
        skill: knockout_gene
        params:
          gene_id: "{gene_id}"
      - agent: flux_analyst
        skill: perform_fba
        params: {}
